jQuery.webshims.register("track-ui",function(e,t){var n=t.cfg.track,r={subtitles:1,captions:1,descriptions:1},i=t.mediaelement,s={update:function(n,r){if(n.activeCues.length){var i=n.displayedActiveCues,s=n.activeCues,o=!0,u=0,a=i.length;if(a!=s.length)o=!1;else for(;u<a;u++)if(i[u]!=s[u]){o=!1;break}if(!o){n.displayedActiveCues=n.activeCues;n.trackDisplay||(n.trackDisplay=e('<div class="cue-display"><span class="description-cues" aria-live="assertive" /></div>').insertAfter(r),this.addEvents(n,r),t.docObserve());n.hasDirtyTrackDisplay&&r.triggerHandler("forceupdatetrackdisplay");this.showCues(n)}}else this.hide(n)},showCues:function(t){var n=e('<span class="cue-wrapper" />');e.each(t.displayedActiveCues,function(r,i){var s=e('<span class="cue-line"><span '+(i.id?'id="cue-id-'+i.id+'"':"")+' class="cue" /></span>').find("span").html(i.getCueAsHTML()).end();"descriptions"==i.track.kind?setTimeout(function(){e("span.description-cues",t.trackDisplay).html(s)},0):n.prepend(s)});e("span.cue-wrapper",t.trackDisplay).remove();t.trackDisplay.append(n)},addEvents:function(e,t){if(n.positionDisplay){var r,i=function(n){if(e.displayedActiveCues.length||!0===n){e.trackDisplay.css({display:"none"});var r=t.getShadowElement();r.offsetParent();var n=r.innerHeight(),i=r.innerWidth(),r=r.position();e.trackDisplay.css({left:r.left,width:i,height:n-45,top:r.top,display:"block"});e.trackDisplay.css("fontSize",Math.max(Math.round(n/30),7));e.hasDirtyTrackDisplay=!1}else e.hasDirtyTrackDisplay=!0},s=function(){i(!0)};t.on("updateshadowdom playerdimensionchange mediaelementapichange updatetrackdisplay updatemediaelementdimensions swfstageresize",function(){clearTimeout(r);r=setTimeout(i,0)});t.on("forceupdatetrackdisplay",s);s()}},hide:function(t){t.trackDisplay&&t.displayedActiveCues.length&&(t.displayedActiveCues=[],e("span.cue-wrapper",t.trackDisplay).remove(),e("span.description-cues",t.trackDisplay).empty())}};e.extend(e.event.customEvent,{updatetrackdisplay:!0,forceupdatetrackdisplay:!0});i.trackDisplay=s;if(!i.createCueList){var o={getCueById:function(e){for(var t=null,n=0,r=this.length;n<r;n++)if(this[n].id===e){t=this[n];break}return t}};i.createCueList=function(){return e.extend([],o)}}i.getActiveCue=function(t,s,o,u){t._lastFoundCue||(t._lastFoundCue={index:0,time:0});Modernizr.track&&!n.override&&!t._shimActiveCues&&(t._shimActiveCues=i.createCueList());for(var a=0,f;a<t.shimActiveCues.length;a++)f=t.shimActiveCues[a],f.startTime>o||f.endTime<o?(t.shimActiveCues.splice(a,1),a--,f.pauseOnExit&&e(s).pause(),e(t).triggerHandler("cuechange"),e(f).triggerHandler("exit")):"showing"==t.mode&&r[t.kind]&&-1==e.inArray(f,u.activeCues)&&u.activeCues.push(f);s=t.cues.length;for(a=t._lastFoundCue.time<o?t._lastFoundCue.index:0;a<s;a++){f=t.cues[a];f.startTime<=o&&f.endTime>=o&&-1==e.inArray(f,t.shimActiveCues)&&(t.shimActiveCues.push(f),"showing"==t.mode&&r[t.kind]&&u.activeCues.push(f),e(t).triggerHandler("cuechange"),e(f).triggerHandler("enter"),t._lastFoundCue.time=o,t._lastFoundCue.index=a);if(f.startTime>o)break}};!n.override&&Modernizr.track&&function(){var r,i=function(t){setTimeout(function(){r=!0;e(t).triggerHandler("updatetrackdisplay");r=!1},9)},s=function(s,o,u){var f="_sup"+u,l={prop:{}},c;l.prop[u]=function(){!r&&!n.override&&Modernizr.track&&i(e(this).closest("audio, video"));return c.prop[f].apply(this,arguments)};c=t.defineNodeNameProperty(s,o,l)};s("track","track","get");["audio","video"].forEach(function(e){s(e,"textTracks","get");s("nodeName","addTextTrack","value")})}();t.addReady(function(r,o){e("video, audio",r).add(o.filter("video, audio")).each(function(){var r=e(this),o=function(){var e,n;if(!l||!f)if(l=r.prop("textTracks"),f=t.data(r[0],"mediaelementBase")||t.data(r[0],"mediaelementBase",{}),!f.displayedActiveCues)f.displayedActiveCues=[];if(l&&((n=r.prop("currentTime"))||0===n)){f.activeCues=[];for(var o=0,u=l.length;o<u;o++)e=l[o],"disabled"!=e.mode&&e.cues&&e.cues.length&&i.getActiveCue(e,r,n,f);s.update(f,r)}},u=function(e){clearTimeout(c);e&&"timeupdate"==e.type?(o(),setTimeout(u,90)):c=setTimeout(o,9)},a=function(){r.off(".trackview").on("play.trackview timeupdate.trackview updatetrackdisplay.trackview",u)},f,l,c;!n.override&&Modernizr.track?r.on("mediaelementapichange trackapichange",function(){n.override||!Modernizr.track||r.is(".nonnative-api-active")?a():(l=r.prop("textTracks"),f=t.data(r[0],"mediaelementBase")||t.data(r[0],"mediaelementBase",{}),e.each(l,function(e,t){t._shimActiveCues&&delete t._shimActiveCues}),s.hide(f),r.unbind(".trackview"))}):a()})})});